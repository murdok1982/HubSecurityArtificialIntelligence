{% extends "base.html" %}

{% block content %}
<div class="max-w-md mx-auto mt-12 animate-in slide-in-from-bottom duration-500">
    <div class="card">
        <div class="text-center mb-8">
            <h2 class="text-3xl font-bold text-white">Bienvenido de nuevo</h2>
            <p class="text-dark-400 mt-2">Accede a tu plataforma de inteligencia</p>
        </div>

        <form id="login-form" hx-post="/api/v1/auth/login" hx-target="#error-msg" hx-swap="innerHTML" class="space-y-6">
            <div>
                <label for="email" class="block mb-2 text-sm font-medium text-dark-300">Email Corporativo</label>
                <input type="email" name="email" id="email" class="input-field" placeholder="admin@organizacion.com"
                    required>
            </div>
            <div>
                <label for="password" class="block mb-2 text-sm font-medium text-dark-300">Contraseña</label>
                <input type="password" name="password" id="password" class="input-field" placeholder="••••••••"
                    required>
            </div>

            <div id="error-msg" class="text-accent-red text-sm font-medium"></div>

            <button type="submit" class="btn-primary w-full py-3 flex justify-center items-center space-x-2">
                <i data-lucide="log-in" class="w-5 h-5"></i>
                <span>Ingresar al Sistema</span>
            </button>
        </form>

        <div class="mt-6 text-center text-dark-400 text-sm">
            ¿No tienes cuenta? <a href="/register" class="text-accent-cyan hover:underline font-bold">Regstrate como
                Tenant</a>
        </div>
    </div>
</div>

<script>
    // Logic to handle success redirect on login
    document.body.addEventListener('htmx:afterRequest', function (event) {
        if (event.detail.pathInfo.requestPath === '/api/v1/auth/login') {
            if (event.detail.successful) {
                const response = JSON.parse(event.detail.xhr.responseText);
                // Store JWT
                localStorage.setItem('access_token', response.access_token);
                // Redirect to dashboard
                window.location.href = '/';
            }
        }
    });
</script>
{% endblock %}