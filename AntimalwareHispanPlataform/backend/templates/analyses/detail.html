{% extends "base.html" %}

{% block content %}
<div class="space-y-6 animate-in fade-in duration-500" hx-get="/api/v1/analyses/{{ analysis_id }}" hx-trigger="load"
    hx-target="#detail-container" hx-swap="innerHTML">
    <!-- Breadcrumbs -->
    <nav class="flex text-dark-500 text-sm" aria-label="Breadcrumb">
        <ol class="inline-flex items-center space-x-1 md:space-x-3">
            <li class="inline-flex items-center">
                <a href="/" class="hover:text-dark-300">Dashboard</a>
            </li>
            <i data-lucide="chevron-right" class="w-4 h-4 mx-2"></i>
            <li class="text-dark-300 font-bold">Detalle de Anlisis</li>
        </ol>
    </nav>

    <div id="detail-container">
        <!-- Skeleton Loader -->
        <div class="card p-12 text-center">
            <div class="flex flex-col items-center space-y-4">
                <div class="w-16 h-16 border-4 border-accent-cyan border-t-transparent rounded-full animate-spin"></div>
                <p class="text-xl font-bold">Procesando Inteligencia de Amenazas...</p>
                <p class="text-dark-400">UUID: {{ analysis_id }}</p>
            </div>
        </div>
    </div>
</div>

<!-- Template for Analysis Results (to be used via HX header or client side rendering) -->
<script id="analysis-template" type="text/template">
    <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
        <!-- Sidebar: Risk Stats -->
        <div class="lg:col-span-1 space-y-6">
            <div class="card bg-gradient-to-b from-dark-900 to-dark-950 text-center">
                <h3 class="text-dark-400 text-xs font-bold uppercase tracking-widest mb-4">Risk Score</h3>
                <div class="relative inline-flex items-center justify-center p-4">
                    <svg class="w-32 h-32 transform -rotate-90">
                        <circle cx="64" cy="64" r="58" stroke="currentColor" stroke-width="8" fill="transparent" class="text-dark-800" />
                        <circle cx="64" cy="64" r="58" stroke="currentColor" stroke-width="8" fill="transparent" 
                            stroke-dasharray="364.4" 
                            stroke-dashoffset="${364.4 - (364.4 * score / 100)}" 
                            class="${score > 70 ? 'text-accent-red' : score > 30 ? 'text-yellow-500' : 'text-green-500'}" />
                    </svg>
                    <span class="absolute text-3xl font-black">${score}</span>
                </div>
                <p class="mt-4 text-sm font-bold uppercase ${score > 70 ? 'text-accent-red' : 'text-dark-400'}">
                    ${score > 70 ? 'Altamente Malicioso' : score > 30 ? 'Sospechoso' : 'Limpio'}
                </p>
            </div>

            <div class="card space-y-4">
                <h4 class="text-white font-bold border-b border-dark-800 pb-2">Veredictos</h4>
                <div class="flex justify-between items-center">
                    <span class="text-dark-400 text-sm">VirusTotal</span>
                    <span class="badge ${vt_detections > 5 ? 'bg-accent-red text-white' : 'bg-dark-800 text-dark-300'} px-2 py-1 rounded text-xs font-bold">
                        ${vt_detections} / 75
                    </span>
                </div>
                <div class="flex justify-between items-center">
                    <span class="text-dark-400 text-sm">YARA Matches</span>
                    <span class="text-white text-xs font-mono">${yara_count}</span>
                </div>
            </div>
        </div>

        <!-- Main Detail: Tabs -->
        <div class="lg:col-span-3 space-y-6">
            <div class="card p-0">
                <div class="border-b border-dark-800">
                    <ul class="flex flex-wrap text-sm font-medium text-center text-dark-400">
                        <li class="mr-2">
                            <button class="inline-block p-4 text-accent-cyan border-b-2 border-accent-cyan active">Resumen</button>
                        </li>
                        <li class="mr-2">
                            <button class="inline-block p-4 border-b-2 border-transparent hover:text-dark-200 hover:border-dark-300">Anlisis Esttico</button>
                        </li>
                        <li class="mr-2">
                            <button class="inline-block p-4 border-b-2 border-transparent hover:text-dark-200 hover:border-dark-300">Comportamiento</button>
                        </li>
                    </ul>
                </div>
                <div class="p-6">
                    <h3 class="text-xl font-bold text-white mb-4">Informacin del Archivo</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                        <div class="space-y-2">
                            <p><span class="text-dark-500">Nombre:</span> <span class="text-white font-mono">${filename}</span></p>
                            <p><span class="text-dark-500">Tamao:</span> <span class="text-white">${size} bytes</span></p>
                            <p><span class="text-dark-500">Tipo:</span> <span class="text-white">${mime}</span></p>
                        </div>
                        <div class="space-y-2">
                            <p><span class="text-dark-500">SHA256:</span> <span class="text-white font-mono break-all text-xs">${sha256}</span></p>
                            <p><span class="text-dark-500">MD5:</span> <span class="text-white font-mono text-xs">${md5}</span></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</script>
{% endblock %}